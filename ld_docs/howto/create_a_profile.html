

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Create a config/profile &mdash; Ultra Fast Lane Detection  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Training" href="train.html" />
    <link rel="prev" title="HOWTO: Create a dataset" href="create_dataset.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Ultra Fast Lane Detection
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="howtos.html">HOWTOs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="howtos.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtos.html#create-dataset">Create dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtos.html#train">Train</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtos.html#test-and-use-the-model">Test and use the model</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="howtos.html#toc">TOC</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="carla_setup.html">CARLA setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="setup.html">Project setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="generate_dataset_from_carla.html">HOWTO: Generate labeled data from CARLA</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_dataset.html">HOWTO: Create a dataset</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Create a config/profile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#h-samples">h_samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#batch-size">batch_size</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-config">Example config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="train.html">Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="test.html">Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="test.html#add-testing-code">Add testing code</a></li>
<li class="toctree-l3"><a class="reference internal" href="test.html#run-test">Run test</a></li>
<li class="toctree-l3"><a class="reference internal" href="test.html#visual-test">Visual test</a></li>
<li class="toctree-l3"><a class="reference internal" href="integrate_into_your_own_project.html">Integrate into your project</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts.html">scripts namespace</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ultra Fast Lane Detection</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="howtos.html">HOWTOs</a> &raquo;</li>
        
      <li>Create a config/profile</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/howto/create_a_profile.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="create-a-config-profile">
<h1>Create a config/profile<a class="headerlink" href="#create-a-config-profile" title="Permalink to this headline">¶</a></h1>
<p>This Howto will explain how to create a config file. It’s using the exam</p>
<p>While in theory all parameters could be set via cli, this is impractical because of the large amount of required parameters.
All parameters have default values defined in the default profile.
We will now create a config file which overrides the most important parameters. Later you will likely change more parameters e.g. to optimize training/quality or depending on your runtime modules.
<strong>All available parameters are described <a class="reference internal" href="../configs.html"><span class="doc std std-doc">here</span></a></strong></p>
<p><em>Note</em>: CLI parameters always have the highest priority and will overwrite whatever is set in config files.</p>
<ul class="simple">
<li><p><strong>dataset</strong>: Give your dataset a beautiful name :)</p></li>
<li><p><strong>data_root</strong>: Absolute path to your datasets root directory</p></li>
<li><p><strong>work_dir</strong>: Absolute path to your working directory (log directory). Most outputs will be stored there (trained models, recorded videos, etc). Some modules might also use this directory for temporary data.</p></li>
<li><p><strong>note</strong> (<em>optional</em>): The train module will create a new directory, under your working directory, every time you start training. This note will be used as a suffix for the folder name. This suffix will make it easier to recognize these folders.</p></li>
<li><p><strong>h_samples</strong>: see below</p></li>
<li><p><strong>img_height</strong>: The height of your input images. You might change this value later in runtime-mode</p></li>
<li><p><strong>img_width</strong>: The width of your input images. You might change this value later in runtime-mode</p></li>
<li><p><strong>epoch</strong> (<em>optional</em>): The number of epochs you want to train. The default value (100) is a good value, but might be too high for quick tests</p></li>
<li><p><strong>batch_size</strong>: see below</p></li>
</ul>
<div class="section" id="h-samples">
<h2>h_samples<a class="headerlink" href="#h-samples" title="Permalink to this headline">¶</a></h2>
<p>The h_samples defined by your dataset.
For further explanations on what h_samples are, see <a class="reference external" href="./create_dataset.html#labels-file">HOWTO: Create dataset - labels file specification</a>
The h_samples are defined in the config as relative values between 0 and 1. The h_samples are required multiple times for different resolutions, e.g. for the net’s resolution which is per default 288px in height. By defining it with a relative height it is really easy to scale the h_samples for the individual heights.</p>
<p>An easy way to scale the h_samples from the dataset to values between 0 and 1 is by dividing them by the image height. This can be easily done with a generator <code class="docutils literal notranslate"><span class="pre">[x/&lt;image</span> <span class="pre">height&gt;</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">[&lt;h_samples&gt;]</span></code>. To further simply this statement the <code class="docutils literal notranslate"><span class="pre">range()</span></code> function could be used here.
It’s preferred to calculate the values here instead of pre-calculating them because they have to be very exact. Nevertheless, it’s also possible to use precalculated values here.
Because of that, this parameter can’t be set via CLI.</p>
<p><strong>Important</strong>: Don’t use the img_height variable in this generator. img_height might be changed later. This would result in a wrong scaling of the h_samples.</p>
</div>
<div class="section" id="batch-size">
<h2>batch_size<a class="headerlink" href="#batch-size" title="Permalink to this headline">¶</a></h2>
<p>This value will depend on many factors.</p>
<ul class="simple">
<li><p><strong>training mode</strong>: The maximum value is limited by your VRAM. For a RESNET18 (default) 11GB of VRAM the maximum is about 56. Finding the best value requires some testing. Too low values drastically decreases performance. Too high values can also result in lower performance. The batch_size can also affect the accuracy. Something around 16 might be a good starting value.</p></li>
<li><p><strong>runtime mode - evaluation / test</strong>: If the output does not have to happen in realtime simply find the batch_size providing the best performance</p></li>
<li><p><strong>runtime mode - realtime / live</strong>: For realtime outputs like video preview or production use the batch size should be set to 1. Everything higher will increase FPS but also the latency. The higher FPS aren’t useful in this case because only the latest sample of the batch will be of interest.</p></li>
</ul>
<p>This diagram shows performance measurements on a 2080Ti and an i7 8800k.
It shows that the best performance can be achieved with a batch size around 16.</p>
<p><img alt="Diagram: benchmark batch sizes" src="../_images/benchmark_batchsize.png" /></p>
<p>Note that the total CPU overhead continues to decrease with higher batch sizes, which can be seen in the next diagram showing the total cpu time.</p>
<p><img alt="Diagram: benchmark batch sizes cpu overhead" src="../_images/benchmark_batchsize_cpu_overhead.png" /></p>
</div>
<div class="section" id="example-config">
<h2>Example config<a class="headerlink" href="#example-config" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="s1">&#39;Example profile&#39;</span>
<span class="n">data_root</span> <span class="o">=</span> <span class="s1">&#39;/home/user/datasets/example_dataset/&#39;</span>
<span class="n">work_dir</span> <span class="o">=</span> <span class="s1">&#39;/home/user/work_dir/&#39;</span>
<span class="n">note</span> <span class="o">=</span> <span class="s1">&#39;_ex_prof&#39;</span>
<span class="n">h_samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">/</span><span class="mi">720</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mi">711</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
<span class="n">img_height</span> <span class="o">=</span> <span class="mi">720</span>
<span class="n">img_width</span> <span class="o">=</span> <span class="mi">1280</span>
<span class="n">epoch</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="train.html" class="btn btn-neutral float-right" title="Training" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_dataset.html" class="btn btn-neutral float-left" title="HOWTO: Create a dataset" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, cfzd; 2020 Markus Heck

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>